# Rollback Playbook â€” Fixnado Platform

This playbook documents the operational steps required to roll back the Fixnado platform when a deployment needs to be reversed. It is designed to integrate directly with the Version 1.00 CI/CD upgrades delivered on 2025-10-14 and references automated artefacts that are now generated by GitHub Actions.

## 1. Triggering the Rollback Workflow
1. Navigate to the **Build, Test & Release** GitHub Actions tab.
2. Launch the `release-artifacts` workflow via **Run workflow**. Select the target branch (typically `main`) and provide the incident/ticket reference in the input field.
3. The workflow packages backend, frontend, and Flutter artefacts while producing `build/rollback-manifest.json` with SHA-256 checksums and version metadata. All artefacts are uploaded as part of the `rollback-kit` bundle.
4. Download the `rollback-kit` artefact from the most recent successful run that predates the faulty deployment.

## 2. Validate Artefacts
1. Extract the manifest and compare the recorded commit to the desired rollback point.
2. Verify the SHA-256 hashes locally:
   ```bash
   shasum -a 256 backend-nodejs-release.tar.gz
   shasum -a 256 frontend-reactjs-dist.tar.gz
   shasum -a 256 app-debug.apk
   ```
3. Confirm the checksums match the manifest to prevent tampering or partial downloads.

## 3. Backend Service Rollback
1. Use `scripts/environment-parity.mjs` to ensure target environment configuration matches the manifest (`node scripts/environment-parity.mjs --env <environment>`).
2. Stop the running backend process via the service manager (e.g., PM2/systemd).
3. Extract the archived package and install production dependencies:
   ```bash
   tar -xzf backend-nodejs-release.tar.gz
   cd backend-nodejs
   npm ci --omit=dev
   ```
4. Reapply encrypted environment secrets if rotation occurred after the reference commit.
5. Run smoke tests (`npm test`) and start the service using the existing process manager configuration.
6. Monitor health endpoints and telemetry dashboards for at least one full alerting cycle (15 minutes) before proceeding.

## 4. Frontend Web Rollback
1. Extract the `frontend-reactjs-dist.tar.gz` package.
2. Upload the `dist/` directory to the CDN or static hosting bucket configured for the respective environment.
3. Invalidate relevant CDN paths (`/`, `/admin`, `/admin/telemetry`, theme assets) to propagate the rollback immediately.
4. Confirm that Theme Studio, Admin Dashboard, and Telemetry Dashboard render without cached asset mismatches using Chromatic captures or manual verification.

## 5. Flutter App Rollback
1. Retrieve `app-debug.apk` from the rollback kit.
2. Upload the binary to the mobile distribution channel (Firebase App Distribution/TestFlight/Enterprise MDM) and flag the release as a rollback candidate.
3. Trigger automated smoke tests on the device farm. Focus on authentication, booking flows, and theme toggles that were impacted by the failed deployment.
4. Notify support teams and update store release notes to explain the reversion if a public release is required.

## 6. Governance & Reporting
1. Record the rollback execution in the incident tracker, referencing:
   - Workflow run URL
   - Artefact checksums and versions
   - Smoke test evidence links
   - Follow-up actions (e.g., hotfix timeline, root cause analysis owner)
2. Update `update_docs/1.00/update_progress_tracker.md` commentary with a summary of the rollback activity for audit purposes.
3. Notify the programme control board and design council so that design QA, analytics, and compliance stakeholders can retest critical journeys.

## 7. Re-Deployment Checklist
Before reattempting deployment:
- Patch or revert the offending changeset and ensure new PRs pass the Build, Test & Scan workflow.
- Re-run `scripts/security-audit.mjs` locally to verify dependencies remain free of high/critical vulnerabilities.
- Capture Chromatic baseline diffs for Theme Studio and Telemetry Dashboard to confirm no regressions were introduced during the rollback.
- Schedule a joint QA/Design sign-off session before promoting to production.

Maintaining this playbook within the repository ensures the rollback process remains auditable, repeatable, and tightly coupled with the automated artefacts now produced by CI/CD.
