# Pre-Update Issue Report (v1.00)

## Executive Summary
The v1.00 evaluation cycle surfaced critical blockers across the backend API, database migrations, dependency stack, web client, and Flutter user app. Secrets are fetched during module import, duplicated routers remap the public surface, JWT verification downgrades on error, and readiness probes mutate PostGIS extensions even when credentials forbid it.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L3-L27】 Audit hooks double-submit payloads, `initDatabase` assumes PostGIS is always available, and health diagnostics emit only truncated console logs, leaving incidents opaque to operators.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L17-L52】 Finance and communications migrations deploy destructive cascades, randomised seed data, nullable gateway references, and unbounded JSON metadata with no retention or audit attribution, so compliance and recovery objectives fail immediately after launch.【F:docs/updates/1.00/pre-update_evaluations/database_evaluation.md†L3-L51】 Dependency manifests are malformed, mix incompatible stacks (MapLibre + Mapbox Draw), and depend on beta/binary packages that cannot build reliably in CI while omitting `engines`, lockfile enforcement, and audit automation.【F:docs/updates/1.00/pre-update_evaluations/dependency_evaluation.md†L3-L69】 The React dashboard trusts `localStorage` for personas, exposes admin panels to unauthenticated visitors, lacks telemetry around route transitions, and crashes en masse because a single `Suspense` boundary wraps seventy lazy routes and a spinner with no context.【F:docs/updates/1.00/pre-update_evaluations/front_end_evaluation.md†L3-L49】 The Flutter build still hinges on demo tokens, blocks rendering behind sequential bootstrap work, drops users into blank error states, and fires crash telemetry with stale version metadata to nonexistent endpoints without awaiting delivery.【F:docs/updates/1.00/pre-update_evaluations/user_app_evaluation.md†L3-L46】 Without coordinated remediation and documentation, the update cannot reach staging.

## Backend Assessment
### Boot & Configuration Safety
The Express gateway mounts several routers (`walletRoutes`, `servicemanRoutes`, `servicemanControlRoutes`) multiple times and remaps `v1` traffic to `/`, so middleware ordering and versioned contracts cannot be trusted.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L3-L28】 Secrets loading, PII configuration, and job schedulers execute during module import inside `config/index.js` and `app.js`, turning transient AWS Secrets Manager latency or missing env vars into fatal boot crashes before logging starts.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L6-L15】【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L43-L46】 `server.js` immediately calls `start()` and then forces `process.exit`, preventing tests and orchestrators from staging listeners or inspecting failures, while readiness checks mutate PostGIS extensions during every probe.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L8-L15】【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L10-L12】【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L54-L56】 Cold starts also block on synchronous secrets fetches, amplifying cascading failures if AWS degrades, and readiness bookkeeping never leaves process memory, so external monitors cannot observe the churn.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L43-L52】

### Authentication & Transport Controls
`verifyAccessToken` silently falls back to a permissive JWT decode for any verification error, so upstream identity providers cannot rely on stricter issuer/audience enforcement.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L25-L33】 The CORS guard reflects arbitrary origins while allowing credentials, Helmet disables CSP/COEP, and storefront overrides are gated only by `NODE_ENV`, widening the attack surface for dashboards and inline scripts.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L30-L35】 Authentication middleware returns twice on missing tokens, masking remediation guidance, and background audit logging risks duplicate payload failures without structured recovery paths.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L5-L6】【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L17-L19】 

### Reliability & Observability
Readiness probes try to create PostGIS extensions on every boot and flip the service into fatal loops when privileges are missing, while rate limiting omits `Retry-After`, swallows stack traces, and throws when proxy headers are absent.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L10-L21】 Health checks only emit `console` logs with trimmed error messages, secrets bootstrap prints stack traces, and `measureDatabaseHealth` hides latency data—so operators cannot diagnose incidents quickly or correlate spikes with upstream dependencies.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L20-L52】 Telemetry routing exposes only `/telemetry/ui-preferences`; browser and mobile crash posts 404, leaving the entire client surface without diagnostics.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L28-L29】 Background jobs for telemetry, analytics, finance, and credential rotation all start by default with no feature gating or concurrency control, risking duplicate processing during rollouts while audit logging risks throwing when duplicate metadata collides.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L17-L57】

## Database Assessment
Finance and communications migrations deploy hundreds of lines of DDL without `sequelize.transaction()` wrappers, so any mid-migration failure leaves dangling foreign keys, destroyed enums, and partially created tables.【F:docs/updates/1.00/pre-update_evaluations/database_evaluation.md†L3-L20】 Cascade deletes from users, services, orders, and regions erase immutable ledgers; webhook events and notification recipients lack idempotency keys; bootstrap inserts skew analytics; gateway references are nullable; and amount columns accept negative values with no CHECK constraints.【F:docs/updates/1.00/pre-update_evaluations/database_evaluation.md†L6-L27】【F:docs/updates/1.00/pre-update_evaluations/database_evaluation.md†L52-L55】 Enum types are unnamespaced, down migrations drop them without `IF EXISTS`, readiness probes crash when PostGIS privileges are missing, and seeds rely on `randomUUID()` or are absent entirely, blocking deterministic replays and forcing operators to craft large JSON payloads manually.【F:docs/updates/1.00/pre-update_evaluations/database_evaluation.md†L9-L18】 Communications settings enforce a single configuration per tenant, ignore audit metadata, and store `allowed_roles` as unvalidated JSON while missing indexes on provider/status columns—hurting compliance, multi-region support, and retry performance.【F:docs/updates/1.00/pre-update_evaluations/database_evaluation.md†L5-L45】 Sensitive payment metadata persists indefinitely without encryption hooks or retention policies, webhook payloads store full PSP responses forever, and notification targets accept unnormalised free text, conflicting with PCI and privacy obligations.【F:docs/updates/1.00/pre-update_evaluations/database_evaluation.md†L30-L34】

## Dependency Assessment
`backend-nodejs/package.json` is syntactically invalid because dependency keys repeat and commas are missing, preventing installs and masking true drift.【F:docs/updates/1.00/pre-update_evaluations/dependency_evaluation.md†L3-L21】 The backend combines `dotenv@17` (ESM-only), native `sqlite3`, beta `bcrypt@6`, and AWS SDK v3 without documenting runtime baselines, so CI pipelines break unpredictably while scripts that expect `require('dotenv')` crash and native builds fail on minimal images.【F:docs/updates/1.00/pre-update_evaluations/dependency_evaluation.md†L8-L33】 Front-end dependencies jump to Vite 6, React 18.3, MapLibre 5, Mapbox Draw 1.5, redundant Turf bundles, and overlapping animation libraries, inflating bundles and risking runtime incompatibilities the team cannot see because bundle analysis tooling is absent.【F:docs/updates/1.00/pre-update_evaluations/dependency_evaluation.md†L6-L48】 Flutter lockfiles were edited manually, biometric plugins require elevated Android SDKs, dependency READMEs are missing, and no project enforces `engines`, lockfile verification, or dependency audits, letting risky upgrades merge unchecked while legal compliance for third-party licenses remains undocumented.【F:docs/updates/1.00/pre-update_evaluations/dependency_evaluation.md†L11-L75】

## Front-end Assessment
The dashboard mounts more than seventy lazy routes inside one `Suspense` boundary backed by a context-free spinner, so a single failed import blanks the entire app without status messaging or granular recovery despite dedicated error components.【F:docs/updates/1.00/pre-update_evaluations/front_end_evaluation.md†L3-L20】 Session bootstrap trusts a fallback stub stored in `localStorage`, never revalidates `/api/auth/me`, and mutates persona unlocks client-side, allowing unauthenticated visitors to grant themselves provider dashboards while corrupted storage loops indefinitely and thrashes renders through synchronous writes.【F:docs/updates/1.00/pre-update_evaluations/front_end_evaluation.md†L6-L33】 Provider denial pages provide static copy without onboarding redirects; localisation failures render blank content; session persistence preserves duplicate casing in navigation; and authenticated layouts hide legal/help footers—breaching compliance expectations and UX standards.【F:docs/updates/1.00/pre-update_evaluations/front_end_evaluation.md†L9-L18】【F:docs/updates/1.00/pre-update_evaluations/front_end_evaluation.md†L34-L41】 Error boundaries leak stack traces and URLs, telemetry posts to missing backend handlers, persona storage never validates payloads, and there is no instrumentation or analytics for route transitions or persona grants, so abuse and crashes go unnoticed.【F:docs/updates/1.00/pre-update_evaluations/front_end_evaluation.md†L15-L50】 Offline fallbacks bypass network validation for critical operations, global chat widgets mount for every persona, and bundle analysis tooling is absent, conflicting with authentication hardening goals and performance budgets.【F:docs/updates/1.00/pre-update_evaluations/front_end_evaluation.md†L22-L49】

## User App Assessment
`AuthGate` lacks a credentialed login path and still depends on `demoAccessToken` fixtures stored like production credentials, so the app cannot serve real tenants or revoke demo identities cleanly.【F:docs/updates/1.00/pre-update_evaluations/user_app_evaluation.md†L3-L29】 Bootstrap work (preferences, secure storage, biometrics) runs sequentially on the UI thread, leaving long blank screens and crashing when plugins misbehave before error handling comes online, while fatal error states provide no inline support guidance or persisted navigation state.【F:docs/updates/1.00/pre-update_evaluations/user_app_evaluation.md†L8-L18】 `AppDiagnosticsReporter` hardcodes `appVersion: '1.50'`, posts plaintext stack traces over arbitrary HTTP endpoints, reuses a single HTTP client with `unawaited` uploads, and omits build/device metadata—losing production telemetry and leaking identifiers into shared logs.【F:docs/updates/1.00/pre-update_evaluations/user_app_evaluation.md†L6-L46】 `AuthTokenController.ensureFreshness` swallows refresh errors, the API client lacks retry/backoff and pagination helpers, environment selection is compile-time only, and bootstrap logging dumps verbose stdout with no level filtering, so transient backend issues and staging workflows surface as fatal states with noisy diagnostics.【F:docs/updates/1.00/pre-update_evaluations/user_app_evaluation.md†L15-L45】 Integration and golden tests are absent, leaving core flows without regression coverage.【F:docs/updates/1.00/pre-update_evaluations/user_app_evaluation.md†L45-L46】

## Cross-Cutting Delivery Risks
Telemetry endpoints are absent across tiers, rate limiting and boot diagnostics emit only console logs, and correlation IDs are not propagated—blocking effective incident reconstruction and hiding abusive bursts across clients.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L20-L52】【F:docs/updates/1.00/pre-update_evaluations/front_end_evaluation.md†L45-L50】【F:docs/updates/1.00/pre-update_evaluations/user_app_evaluation.md†L36-L46】 Dependency stacks demand Node 18+, Android SDK 23+, biometric platform hooks, and native toolchains, yet onboarding guides omit prerequisites, CI skips lockfile validation, and no license/audit automation guards risky upgrades.【F:docs/updates/1.00/pre-update_evaluations/dependency_evaluation.md†L11-L75】 Background jobs, destructive migrations, offline fallbacks, and demo tokens all run by default without feature flags, making blue/green deployments or demo builds dangerous and misaligned with roadmap priorities around focused persona rollouts.【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L37-L57】【F:docs/updates/1.00/pre-update_evaluations/front_end_evaluation.md†L34-L49】【F:docs/updates/1.00/pre-update_evaluations/user_app_evaluation.md†L21-L40】 Provider-specific mobile apps are not present in this repository, so the Flutter user app is the sole mobile surface under review; nevertheless, its reliance on demo flows, missing telemetry, and lack of regression coverage prevent production launch.【F:docs/updates/1.00/pre-update_evaluations/user_app_evaluation.md†L3-L46】 Documented runtime prerequisites, operator runbooks, structured telemetry, and database retention policies must land before the release can proceed.【F:docs/updates/1.00/pre-update_evaluations/dependency_evaluation.md†L40-L75】【F:docs/updates/1.00/pre-update_evaluations/database_evaluation.md†L30-L51】【F:docs/updates/1.00/pre-update_evaluations/backend_evaluation.md†L48-L57】
