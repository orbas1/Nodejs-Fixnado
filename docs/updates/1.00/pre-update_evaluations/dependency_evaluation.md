# Dependency Pre-Update Evaluation (v1.00)

## Functionality
- `backend-nodejs/package.json` is syntactically invalid because `dependencies` repeats the `zod` and `validator` keys multiple times and is missing commas, so any install fails before the service can run. (`backend-nodejs/package.json`).
- The backend still targets `sequelize@6.37.7` and `pg@8.13.1`, which do not expose native Prisma-style migrations expected by newer tooling, complicating future ORM upgrades. (`backend-nodejs/package.json`).
- Front-end dependencies pull in both MapLibre and Turf for geospatial visualisation even though the dashboards module does not yet expose map widgets, inflating bundle size without clear functional benefit. (`frontend-reactjs/package.json`).

## Usability & Operability
- The backend relies on `dotenv@17` which switched to ESM-only entry points; local scripts that expect `require('dotenv')` (for example legacy test utilities) will break without code changes. (`backend-nodejs/package.json`).
- Front-end tooling jumps to `vite@6` while `@vitejs/plugin-react@5` still documents compatibility gaps; developers will fight breaking config APIs during every incremental upgrade. (`frontend-reactjs/package.json`).
- The Flutter app bundles Riverpod, secure storage, and local auth; newcomers must provision platform-specific native modules before the app compiles, slowing onboarding. (`flutter-phoneapp/pubspec.yaml`).
- The repo checks in `package-lock.json` and `pubspec.lock`, but there are no CI checks verifying they stay in sync with `package.json`/`pubspec.yaml`, so drift will only surface during deployments. (`frontend-reactjs/package.json`, `flutter-phoneapp/pubspec.yaml`).
- Backend scripts call out to `k6` (`scripts/run-load-tests.mjs`) without guarding for its absence, so dependency install failures cascade into tooling crashes that developers must debug manually. (`backend-nodejs/package.json`, `scripts/run-load-tests.mjs`).

## Errors & Stability
- Duplicate dependency keys in the backend JSON not only prevent install but also hide real version drift because npm stops parsing after the first duplicate. (`backend-nodejs/package.json`).
- The backend's dependency on `sqlite3@5.1.7` for tests requires native compilation; CI images without build-essential will fail instantly. (`backend-nodejs/package.json`).
- Because `dotenv` is ESM-only, any CommonJS helper that imports it (for example scripts launched via `node -r dotenv/config`) will throw `ERR_MODULE_NOT_FOUND`, breaking long-lived automation. (`backend-nodejs/package.json`).
- The Flutter lockfile is annotated as “Generated by hand”, so the versions are not machine-resolved and may omit transitive constraints that `pub get` enforces, leading to unpredictable diffs when the real solver runs. (`flutter-phoneapp/pubspec.lock`).
- The malformed backend dependency block terminates before `"uuid"` because stray `validator`/`zod` fragments break JSON parsing, so npm aborts before installing mandatory modules or writing a lockfile. (`backend-nodejs/package.json`).

## Integration & Compatibility
- `@aws-sdk/client-secrets-manager@3.585.0` requires Node 18+, yet deployment scripts may still run under Node 16 in older environments, causing runtime import errors. (`backend-nodejs/package.json`).
- The front-end pins `react@18.3.1` (experimental) alongside legacy libraries such as `recharts@2.12.7` that officially support React 17/18 stable only, risking runtime warnings and broken charts. (`frontend-reactjs/package.json`).
- Flutter dependencies mix stable (`http@1.5.0`) with biometric plugins that require minimum Android SDK 23; without aligning Gradle config, builds will fail to link `local_auth`. (`flutter-phoneapp/pubspec.yaml`).
- `@mapbox/mapbox-gl-draw@1.5.0` is built for Mapbox GL JS 1.x, but the project uses `maplibre-gl@5.9.0`, so type definitions and draw controls will misbehave or crash without compatibility shims. (`frontend-reactjs/package.json`).

## Security
- The backend exposes `bcrypt@6.0.0`, which is still in beta and may contain ABI regressions; downgrading to the latest 5.x LTS reduces the risk of silent hash corruption. (`backend-nodejs/package.json`).
- `jsonwebtoken@9.0.2` has open CVEs when used without explicit `clockTolerance`; the service currently does not enforce that option, increasing token replay risk. (`backend-nodejs/package.json`).
- `flutter_secure_storage@9.2.4` on Android requires encrypted shared preferences; without configuring a strong `KeyGenParameterSpec`, credentials might default to weaker AES settings. (`flutter-phoneapp/pubspec.yaml`).
- `@heroicons/react@2.2.0` pulls SVGs under the MIT license, but no license auditing step verifies compatibility with proprietary builds, leaving legal compliance unchecked. (`frontend-reactjs/package.json`, `scripts/security-audit.mjs`).

## Performance & Build Footprint
- Shipping both `@turf/bbox` and the full `@turf/turf` meta-package pulls in redundant geospatial helpers, slowing install and ballooning bundle size. (`backend-nodejs/package.json`, `frontend-reactjs/package.json`).
- Express 5 and Vite 6 upgrades happen simultaneously, forcing every environment to adopt Node 18+ and new ESM semantics at once; this increases cold-start time for CI and dev containers that must transpile larger dependency graphs. (`backend-nodejs/package.json`, `frontend-reactjs/package.json`).
- Flutter's dependency list omits platform-specific overrides, so Gradle and Cocoapods will attempt to resolve latest transitive versions on every build, lengthening CI cycles. (`flutter-phoneapp/pubspec.yaml`).
- The React bundle ships with both `framer-motion` and bespoke animation utilities, so tree-shaking fails to prune unused motion primitives and inflates first paint. (`frontend-reactjs/package.json`, `frontend-reactjs/src/App.jsx`).

## Governance & Tooling
- There is no automated dependency auditing hook tied to the existing `scripts/security-audit.mjs`, so regressions like duplicate keys slip through code review. (`backend-nodejs/package.json`, `scripts/security-audit.mjs`).
- Package scripts still point to `run-load-tests.mjs`, but that script shells out to Node without verifying dependencies are installed, leading to brittle tooling when installs fail. (`backend-nodejs/package.json`, `scripts/run-load-tests.mjs`).
- None of the packages declare `engines` ranges, leaving Node and Flutter version drift unchecked across teams and environments. (`backend-nodejs/package.json`, `frontend-reactjs/package.json`, `flutter-phoneapp/pubspec.yaml`).
- Dependency READMEs are absent, so teams lack guidance on how to provision native prerequisites like `sqlite3` or `local_auth`, increasing onboarding friction. (`backend-nodejs/package.json`, `flutter-phoneapp/pubspec.yaml`).

## Documentation & Process
- No changelog or ADR captures the rationale for adopting experimental React 18.3 builds or bcrypt v6, making it hard for reviewers to judge upgrade readiness. (`frontend-reactjs/package.json`, `backend-nodejs/package.json`).
- Security audit scripts exist but are disconnected from pull-request workflows, so developers rarely see actionable remediation steps when introducing risky packages. (`scripts/security-audit.mjs`).

## Alignment & Roadmap Fit
- Dependency choices imply a fully serverless secrets pipeline (AWS SDK v3) but the infrastructure folder still contains Terraform for self-hosted Postgres, signalling misalignment between planned hosting models and code dependencies. (`backend-nodejs/package.json`).
- Heavy geospatial tooling on the front-end (MapLibre, Turf) contrasts with current product priorities focused on provider onboarding, suggesting the update scope may overreach. (`frontend-reactjs/package.json`).
- Mobile dependencies focus on biometrics and secure storage, yet backlog items emphasise booking flows; dependency budget should pivot toward offline caching or notifications instead. (`flutter-phoneapp/pubspec.yaml`).

## Recommendations
- Repair `package.json` syntax, remove duplicate keys, and introduce `npm pkg fix` CI checks to prevent recurrence.
- Align runtime baselines (Node, Android, iOS) with dependency minimums and document them in the deployment guides.
- Review transitive bundles (MapLibre, Turf, biometric plugins) against roadmap deliverables and trim anything that is not needed for the v1.00 release.
- Wire the existing security audit scripts into CI and add `engines` metadata so unsupported runtimes fail fast.
- Add dependency drift checks (lockfile verification, license scanning) to CI and document native prerequisite setup for new contributors.
