
## Compliance & Security Signalling (Added 2025-10-15)
- **Telemetry Dashboard Help Drawer:** Add inline “Privacy & Opt-out” accordion summarising hashed-IP anonymisation, retention windows (12 months), and quick link to support article KB-182. Drawer accessible via question mark icon with focus trap + escape support.
- **Feature Toggle Audit Trail Panel:** Insert table column for `Change request ID` and tooltip describing audit logging path; emphasise only Global Admin can mutate toggles. Provide link to compliance contact for approvals.
- **Document Retention Widgets:** Compliance dashboard card surfaces upcoming document purge events (rental agreements reaching 7-year limit) with CTA to review or extend hold; include legend aligning with DPIA action plan statuses.
- **RBAC Warning Banner:** When compliance officers view redacted data, show persistent banner clarifying reason for masking and steps to request temporary reveal, referencing RBAC minutes item RBAC-02.

## Inventory Health & Reconciliation (Added 2025-10-16)
- **Stock Health Overview Card:** 3-column layout mirroring provider mobile widget with aggregated metrics for on-hand, reserved, damaged. Include sparkline for last 7 days and threshold chips derived from `/api/inventory/health`. Card uses `color.surface.layer` background with state-specific accent border.
- **Alert Queue Widget:** Vertical list grouped by severity with filter chips (All, Warning, Critical). Each entry displays SKU, location, variance delta, and ageing timer. Provide inline actions `Ack`, `Snooze`, `Escalate`; actions call corresponding endpoints and update list without refresh.
- **Reconciliation Pipeline:** Timeline component summarising scheduled counts, overdue reconciliations, and completed actions. Integrate color-coded status icons and CTA `Open reconciliation sheet` linking to modal (see Application Design plan). Display SLA badge when overdue >24h.
- **Variance Heatmap:** Grid view plotting SKUs vs location with colour intensity representing variance percentage. Hover tooltip reveals last count owner, variance reason, and attachments indicator. Supports exporting screenshot to PNG for finance review.
- **Finance Drill-down Drawer:** When admin selects an alert, open side drawer showing ledger snapshot, attachments, and decision log. Provide `Request evidence` button triggering Slack message to provider with templated copy.
- **Telemetry Hooks:** Each widget includes `data-qa` selectors for automation and emits events `inventory.dashboard.widget_view` with widgetId + filters so analytics can audit adoption.

## Rental Lifecycle Dashboards (Added 2025-10-17)
- **Rental Pipeline Board:** Admin dashboard replicates kanban columns with header metrics (count, deposit value, overdue). Columns support sticky headers on scroll, and cards show renter, items, pickup/return schedule, deposit badge. Inline quick actions align with `/api/rentals` endpoints.
- **Inspection Queue Widget:** List of inspections awaiting completion sorted by due date. Each row displays rental ID, location, assigned inspector, outstanding checklist count, and deposit at risk. Buttons `Open workbench` and `Reassign` trigger respective modals.
- **Deposit Exposure Chart:** Bar chart comparing total deposits held vs refunds pending across time range (7, 14, 30 days). Hover reveals breakdown by category (Tools, Vehicles, Accessories) with link to export dataset.
- **Dispute Resolution Panel:** Table listing active disputes with severity, ageing, reason codes, assigned owner, and next action. Provide CTA `View case` to open detail drawer with attachments, ledger context, and messaging logs.
- **Compliance Snapshot:** Card summarising expiring insurance certificates, missing documents, and DPIA purge schedule reminders with CTA linking to compliance settings. Includes legal copy referencing retention rules.
- **Telemetry Hooks:** Widgets emit events `rental.dashboard.widget_view`, `rental.inspection.queue_action`, and `rental.dispute.action` containing `{ rentalId, action, severity }` for analytics and MTTA tracking.

## Campaign Manager Dashboard Widgets (Added 2025-10-19)
- **Campaign Performance Summary:** KPI tiles for Spend to date, Delivery %, CTR, CPA with comparison chips vs previous period. Tiles include info tooltips referencing data source (daily metrics) and emit telemetry `campaign.dashboard.kpi_view`.
- **Pacing Timeline Canvas:** Multi-series line chart showing planned vs actual spend with overspend threshold shading. Includes toggle for cumulative vs daily view, zoom controls (7/14/30 days), and annotation markers for pauses/invoice events. Export options: CSV, PNG, Slack share.
- **Flight Status Grid:** Table with flights grouped by campaign showing status, start/end, daily budget, spend, delivery, pacing badge. Supports column sorting, inline pause/resume buttons, and bulk actions with confirmation modals.
- **Targeting Coverage Heatmap:** Matrix of targeting types vs campaign count showing utilisation and spend share. Clicking cell opens filtered list of campaigns using that targeting. Provides insights for marketing strategy.
- **Invoice Aging Waterfall:** Chart summarising invoices by status (Draft, Issued, Due Soon, Overdue, Paid). Includes due countdown chips and CTA `View aging report` linking to billing drawer filtered for overdue invoices.
- **Overspend Alerts Panel:** List of campaigns in overspend or at-risk state with badges indicating severity, spend delta, days paused, and recommended action. Buttons `Resume`, `Escalate`, `Adjust budget` call respective endpoints or open modals with finance copy.
- **Compliance Reminder Card:** Displays campaigns blocked by insured seller status or pending compliance documents. Offers CTA to open compliance queue and replicates microcopy emphasising regulatory obligations.
- **Telemetry Hooks:** Widgets emit events `campaign.dashboard.widget_view`, `campaign.dashboard.flight_action`, `campaign.dashboard.overspend_escalate`, and `campaign.dashboard.invoice_export` with payloads for analytics/fraud monitoring.

## Campaign Analytics Export & Fraud Operations (Added 2025-10-20)
- **Export Status Tiles:** Three responsive tiles (`Pending`, `Sent (24h)`, `Failed`) powered by `/api/campaigns/:id/analytics-exports/summary`. Tiles show count, trend delta vs prior 24 hours, and countdown chip to next scheduled retry. Failed tile includes warning icon + CTA `Open export queue` launching detailed modal; tooltip warns when `analyticsEndpoint` or API key missing.
- **Export Queue Modal Widget:** Paginated table (50 rows) listing exports with columns `Metric Date`, `Payload Hash`, `Attempts`, `Last Response`, `Next Retry`. Each row includes quick actions `Retry now`, `Download JSON`, `Copy payload ID`. Modal exposes filter pills (All, Pending, Failed, Sent) and multi-select to bulk retry. Header surfaces aggregated stats and SLA banner if failed exports exceed 3 or oldest failure > 30m.
- **Fraud Anomaly Rail:** Sticky right rail showing anomaly cards grouped by severity. Cards display metric snapshot (CTR/CVR/Spend delta), detection timestamp, baseline comparison, and action buttons `Assign`, `Resolve`, `Escalate`. Rail references `dashboard_drawings.md` anomaly sketches and ensures cards collapse gracefully on narrower viewports. Resolved signals appear under accordion with timestamp + note for audit.
- **ROI & Conversion KPI Strip:** Adds ROI %, Conversion Rate, Spend Delta vs plan, and Open Anomaly count to hero strip. Each tile includes info tooltip defining formula, and `Escalate` CTA on anomaly tile linking to fraud runbook. Data sourced from `/api/campaigns/:id/summary` aggregator.
- **Notification Activity Feed:** Dedicated section summarising exporter failures, retried payloads, and fraud escalations with icons (warehouse, fraud shield, finance). Entries show actor (system vs user), communication channel (Slack/email/in-app), and include `View details` CTA linking to relevant modal. Feed integrates with operations runbook and stores filters for `Export`, `Fraud`, `Billing` categories.
- **Ops Readiness Checklist:** Collapsible panel enumerating environment prerequisites (API key configured, warehouse reachable, fraud SLA < 30m, exporter job healthy). Each item pulls from health endpoint and renders pass/fail icon plus remediation link.
- **Telemetry Hooks:** Export tiles emit `campaign.dashboard.export_tile_view` with counts; queue modal logs `campaign.analytics.export.retry` & `campaign.analytics.export.bulk_retry`; anomaly rail logs `campaign.dashboard.fraud_assign`/`resolve`; notification feed logs `campaign.dashboard.notification_open`. Payload includes `campaignId`, `signalType`, `attemptCount`, `resolutionLatencyMs` for analytics.
- **Accessibility Notes:** Tiles expose `aria-live="polite"` for count updates; modal ensures focus trap and table row selection accessible via keyboard. Anomaly rail includes skip link for screen readers and ensures severity colours meet contrast ratios; numbers formatted with `aria-label` describing units (e.g., “ROI 142 percent”).

## Analytics Pipeline Control Console (Added 2025-10-28)
- **Status & Health Tile:** KPI tile summarises pipeline status (Active/Paused/Degraded), backlog count, oldest pending timestamp, and next retry countdown. Secondary text displays last successful run and failure streak with colour-coded border (green/amber/red). Tile includes CTA `Manage pipeline` linking to control modal.
- **Control Modal Blueprint:** Pause/resume modal captures actor, role, ticket, justification, and expected duration. Warning banner reiterates downstream impact and links to runbook `OPS-AN-07`. Confirmation button disabled until acknowledgement checkbox and required fields completed.
- **Run Ledger Widget:** Table component with sticky header lists recent runs (`Started`, `Duration`, `Processed`, `Purged`, `Status`, `Failure streak`, `Actor`, `Ticket`). Failed rows show inline alert with tooltip linking to error drawer. Supports CSV export, status filtering, and `data-qa="analytics-run-history-row"` selectors.
- **Backlog Sparkline & Failure Gauge:** Left column sparkline charts backlog over last 12 hours with threshold overlay; right column gauge visualises failure streak vs configured retry schedule. Both widgets trigger aria-live updates when thresholds crossed and expose tooltip copy defining metrics.
- **Toggle Audit Feed:** Activity feed summarises pause/resume actions with timestamp, actor, ticket ID, and notes. Entries include CTAs `View run` and `Open incident`. Feed references Secrets Manager parity state and indicates environment (staging read-only badges).
- **Accessibility & QA Hooks:** All widgets list `data-qa` selectors, focus order, and keyboard shortcuts (`Shift+P`, `Shift+R`, `Ctrl+Shift+H` open history). Live region guidelines ensure status changes announced politely. Responsive behaviour documented for tablet/mobile breakpoints (stacked cards, accordion run history).

## Persona Dashboard Toggle Gating (Added 2025-10-31)
- **Toggle Summary Card:** Left rail card displays manifest name, toggle key, owning squad, last rotated timestamp, active cohort, and health chip (Active, Cooling Down, Disabled). Includes CTA `Refresh toggles` with inline spinner, tooltip referencing Secrets Manager latency expectations, and `data-qa="toggle-summary"` selector. Success state surfaces confirmation toast (“Toggles refreshed from Secrets Manager 20s ago”).
- **Access Gate Banner:** When persona cohort disabled, hero area swaps to gated banner containing persona illustration, gating headline (“Analytics pilot restricted”), explanation copy, and bullet list of prerequisites (approved ticket, analytics ops sign-off). CTA `Request pilot access` opens inline form capturing ticket ID + justification; submission posts telemetry `feature.toggle.request_access` and links to runbook `OPS-AN-12` for escalation steps. Error state surfaces inline validation copy referencing required ticket format.
- **Pilot Access Form:** Inline sheet captures actor name (prefilled from profile), ticket reference, desired enablement window, and optional notes. Confirmation displays compliance acknowledgement checkbox referencing DPIA retention statement. Form emits telemetry `feature.toggle.refresh` when refresh invoked post submission and records `data-qa="toggle-request-submit"` for automation.
- **Audit Banner & Activity Feed:** Post-submission, banner confirms “Access request logged — Ops will confirm via Slack #analytics-pilots”. Activity feed logs request timestamp, actor, cohort, and pending status; once toggle enabled, feed entry flips to `Approved` with manifest snapshot link and refresh CTA. Feed items include assistive text for screen readers summarising action history.
- **Cross-channel Parity:** Spec references Flutter parity backlog — mobile admin dashboards display read-only summary card and gating banner with deep link to support ticket workflow. Documentation points to `DashboardAccessGate.jsx`, `FeatureToggleProvider.jsx`, and `frontend-reactjs/src/api/featureToggleClient.js` to align implementation with gating UX.
- **Telemetry & QA Hooks:** All gating elements expose selectors (`data-qa="dashboard-gate"`, `data-qa="toggle-refresh"`, `data-qa="toggle-request-ticket"`), aria-live attributes for status transitions, and analytics IDs `feature.toggle.refresh`, `feature.toggle.request_access`, `feature.toggle.audit`. QA scenarios cover disabled/enabled states, failed refresh (Secrets Manager 503), and localisation fallback for Spanish copy.

## Analytics Governance Catalogue Panel (Added 2025-11-05)
- **Operations Overview Card:** 4-column tile surfaces catalogue version (e.g., `v2025.11.05`), last publish timestamp, and status pill (`Healthy`, `Pending approvals`, `Blocked`) derived from `dataGovernancePublishJob` telemetry. Tile includes quick links `Open portal`, `Download markdown`, and `View runbook` referencing `OPS-AN-15`. Secondary text lists approval triad (Compliance Lead, Legal Counsel, Data Steward) with inline avatars + tooltips containing rationale and ticket IDs.
- **Publish Controls Strip:** Adjacent control group provides `Preview markdown` ghost button and `Publish update` primary CTA. Buttons expose keyboard shortcuts (`Shift+O`, `Shift+P`) in tooltip and disable automatically when approvals are stale or job queue busy. Error banner area sits beneath strip to show portal outage copy with fallback CTA `Send fallback to Slack` linking to operations channel.
- **Approval Rail:** Right rail lists pending approvals with countdown badge (hours until SLA breach), contact method chips (Slack, Email), and CTA `Nudge owner`. Each entry references `data-qa="catalogue-approval-list"` selector and triggers aria-live announcement when status changes. Completed approvals collapse into “Recent publishes” accordion showing actor, timestamp, and runbook note.
- **Telemetry & QA Instrumentation:** CTAs emit `analytics.catalogue.preview`, `analytics.catalogue.publish`, and `analytics.catalogue.fallback` events with payload `{ actorId, companyId, previousVersion, targetVersion, transport }`. Panel exposes selectors (`data-qa="catalogue-status-pill"`, `data-qa="catalogue-publish"`, `data-qa="catalogue-fallback"`) for automation and includes skeleton loading state (grey shimmer rows) to maintain parity with dashboards skeleton tokens.
- **Fallback Workflow Notes:** When portal publish fails, surface inline warning with copy “Portal unreachable — fallback markdown sent to #ops-analytics” and CTA `Acknowledge` that logs timestamp + actor. Copy references retention reminder (“Ensure approved markdown archived for 400 days”). Success toast references destination channel and includes correlation ID from job payload.
- **Responsive Behaviour:** Tablet breakpoint stacks card above controls; approval rail collapses into accordion accessible via `Manage approvals` button. Mobile view presents read-only summary with status pill, version, and next rehearsal date; publish CTA replaced with guidance to use desktop.
